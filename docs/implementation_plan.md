# DAgger + Speed-Aware 구현 계획 (최종)

## 데이터 형식 재검토

**결론: 7클래스 + 속도 입력 (Speed-Aware DAgger)**

```
┌───────────────────────────────────────────────────────────────┐
│ 기존 7클래스만                │ Speed-Aware (권장)            │
├───────────────────────────────────────────────────────────────┤
│ 입력: 이미지 2장              │ 입력: 이미지 2장 + 현재 속도   │
│ 출력: KeyAction (0~6)         │ 출력: KeyAction (0~6)         │
│                               │                               │
│ ❌ 같은 이미지, 다른 속도     │ ✅ 속도에 따라 다른 판단 가능  │
│    → 같은 예측                │    → 빠르면 조심, 느리면 과감  │
└───────────────────────────────────────────────────────────────┘
```

**이유:**
- 빠른 속도에서 FORWARD_LEFT ≠ 느린 속도에서 FORWARD_LEFT
- 속도 정보가 있으면 모델이 상황에 맞는 판단 가능
- 클래스 수는 7개 유지 (13개로 늘리면 데이터 부족 문제)

---

## 워크플로우 확인 ✅

**맞습니다!** 아래가 정확한 이해입니다:

```
[Phase 1: 초기 학습]
1. 수동으로 세션 데이터 수집 (전문가 주행)
2. train_classification.py(또는 speed-aware 버전)로 학습
3. export_onnx_v2.py로 ONNX 변환

[Phase 2: DAgger 루프]
4. AutonomousDrivingController에 모델 할당
5. 유니티 플레이 → P키로 자율주행 시작
6. AI가 실수할 것 같으면 WASD로 개입 (이 데이터 저장됨)
7. 키보드 놓으면 3초 후 AI 모드 복귀
8. 목적지 도달 시 플레이 종료
9. 5~8 반복 (개입 데이터 축적)
10. 충분한 데이터 모이면 → 2번으로 돌아가 재학습
11. 원하는 결과까지 2~10 반복
```

---

## 파일 변경

### [NEW] train_classification_v2.py
- 이미지 + 속도 입력 모델

### [MODIFY] AutonomousDrivingController.cs
- WASD 개입 감지 → 수동 모드 전환
- 개입 중 데이터 저장 연동
- 3초 후 AI 모드 자동 복귀

### [MODIFY] DrivingDataCollectorV2.cs
- AI 주행 중 녹화 지원
- 세션에 intervention 마킹

### [NEW] export_onnx_v3.py
- Speed-Aware 모델 ONNX 변환
